{
  "workflows": [
    {
      "name": "Vapi.ai - Registrar Chamadas",
      "nodes": [
        {
          "parameters": {
            "path": "vapi-chamadas",
            "responseMode": "onReceived",
            "responseData": "{\n  \"status\": \"success\",\n  \"message\": \"Chamada registrada\"\n}",
            "options": {}
          },
          "id": "webhook_vapi",
          "name": "Webhook - Vapi.ai",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            250,
            300
          ]
        },
        {
          "parameters": {
            "mode": "runOnceForAllItems",
            "jsCode": "return [\n  {\n    \"cliente_id\": 1,\n    \"data_hora\": new Date().toISOString(),\n    \"duracao_segundos\": $input.first().json.duration || 0,\n    \"transcricao\": $input.first().json.transcription || \"\",\n    \"resumo\": $input.first().json.summary || \"\",\n    \"status\": \"completada\"\n  }\n]"
          },
          "id": "function_extract",
          "name": "Extrair Dados",
          "type": "n8n-nodes-base.function",
          "typeVersion": 1,
          "position": [
            450,
            300
          ]
        },
        {
          "parameters": {
            "host": "https://l1kwgyabiotfloyvhml.supabase.co",
            "operation": "insert",
            "schema": "public",
            "table": "chamadas",
            "columns": "cliente_id,data_hora,duracao_segundos,transcricao,resumo,status",
            "options": {}
          },
          "id": "supabase_insert",
          "name": "Supabase - Inserir Chamada",
          "type": "n8n-nodes-base.postgres",
          "typeVersion": 2,
          "position": [
            650,
            300
          ],
          "credentials": {
            "postgres": "supabase_secretaria"
          }
        }
      ],
      "connections": {
        "webhook_vapi": {
          "main": [
            [
              {
                "node": "function_extract",
                "branch": 0,
                "slot": 0
              }
            ]
          ]
        },
        "function_extract": {
          "main": [
            [
              {
                "node": "supabase_insert",
                "branch": 0,
                "slot": 0
              }
            ]
          ]
        }
      },
      "active": true,
      "settings": {
        "executionOrder": "v1"
      }
    },
    {
      "name": "WhatsApp - Receber Mensagens",
      "nodes": [
        {
          "parameters": {
            "path": "whatsapp-mensagens",
            "responseMode": "onReceived",
            "responseData": "{\n  \"status\": \"success\",\n  \"message\": \"Mensagem recebida\"\n}",
            "options": {}
          },
          "id": "webhook_whatsapp",
          "name": "Webhook - WhatsApp",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            250,
            300
          ]
        },
        {
          "parameters": {
            "mode": "runOnceForAllItems",
            "jsCode": "return [\n  {\n    \"cliente_id\": 1,\n    \"conteudo\": $input.first().json.message || \"\",\n    \"tipo\": $input.first().json.type || \"texto\",\n    \"url_midia\": $input.first().json.media_url || null,\n    \"direcao\": \"entrada\",\n    \"status\": \"recebida\"\n  }\n]"
          },
          "id": "function_extract",
          "name": "Extrair Dados",
          "type": "n8n-nodes-base.function",
          "typeVersion": 1,
          "position": [
            450,
            300
          ]
        },
        {
          "parameters": {
            "host": "https://l1kwgyabiotfloyvhml.supabase.co",
            "operation": "insert",
            "schema": "public",
            "table": "mensagens_whatsapp",
            "columns": "cliente_id,conteudo,tipo,url_midia,direcao,status",
            "options": {}
          },
          "id": "supabase_insert",
          "name": "Supabase - Inserir Mensagem",
          "type": "n8n-nodes-base.postgres",
          "typeVersion": 2,
          "position": [
            650,
            300
          ],
          "credentials": {
            "postgres": "supabase_secretaria"
          }
        }
      ],
      "connections": {
        "webhook_whatsapp": {
          "main": [
            [
              {
                "node": "function_extract",
                "branch": 0,
                "slot": 0
              }
            ]
          ]
        },
        "function_extract": {
          "main": [
            [
              {
                "node": "supabase_insert",
                "branch": 0,
                "slot": 0
              }
            ]
          ]
        }
      },
      "active": true,
      "settings": {
        "executionOrder": "v1"
      }
    },
    {
      "name": "Agendamentos - Sistema Autom\u00e1tico",
      "nodes": [
        {
          "parameters": {
            "path": "agendar",
            "responseMode": "onReceived",
            "responseData": "{\n  \"status\": \"success\",\n  \"message\": \"Agendamento criado\"\n}",
            "options": {}
          },
          "id": "webhook_agendar",
          "name": "Webhook - Agendar",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            250,
            300
          ]
        },
        {
          "parameters": {
            "mode": "runOnceForAllItems",
            "jsCode": "return [\n  {\n    \"cliente_id\": $input.first().json.cliente_id || 1,\n    \"data_agendamento\": $input.first().json.data || new Date().toISOString().split('T')[0],\n    \"hora_agendamento\": $input.first().json.hora || \"10:00\",\n    \"local\": $input.first().json.local || \"Rua Rio Grande do Norte, 159\",\n    \"servico\": $input.first().json.servico || \"Atendimento\",\n    \"status\": \"agendado\"\n  }\n]"
          },
          "id": "function_extract",
          "name": "Extrair Dados",
          "type": "n8n-nodes-base.function",
          "typeVersion": 1,
          "position": [
            450,
            300
          ]
        },
        {
          "parameters": {
            "host": "https://l1kwgyabiotfloyvhml.supabase.co",
            "operation": "insert",
            "schema": "public",
            "table": "agendamentos",
            "columns": "cliente_id,data_agendamento,hora_agendamento,local,servico,status",
            "options": {}
          },
          "id": "supabase_insert",
          "name": "Supabase - Inserir Agendamento",
          "type": "n8n-nodes-base.postgres",
          "typeVersion": 2,
          "position": [
            650,
            300
          ],
          "credentials": {
            "postgres": "supabase_secretaria"
          }
        }
      ],
      "connections": {
        "webhook_agendar": {
          "main": [
            [
              {
                "node": "function_extract",
                "branch": 0,
                "slot": 0
              }
            ]
          ]
        },
        "function_extract": {
          "main": [
            [
              {
                "node": "supabase_insert",
                "branch": 0,
                "slot": 0
              }
            ]
          ]
        }
      },
      "active": true,
      "settings": {
        "executionOrder": "v1"
      }
    },
    {
      "name": "Notifica\u00e7\u00f5es - Alertar T\u00e9cnico",
      "nodes": [
        {
          "parameters": {
            "path": "notificar-tecnico",
            "responseMode": "onReceived",
            "responseData": "{\n  \"status\": \"success\",\n  \"message\": \"Notifica\u00e7\u00e3o enviada\"\n}",
            "options": {}
          },
          "id": "webhook_notificar",
          "name": "Webhook - Notificar",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            250,
            300
          ]
        },
        {
          "parameters": {
            "mode": "runOnceForAllItems",
            "jsCode": "return [\n  {\n    \"cliente_id\": $input.first().json.cliente_id || 1,\n    \"data_hora\": new Date().toISOString(),\n    \"duracao_segundos\": 0,\n    \"transcricao\": \"NOTIFICA\u00c7\u00c3O: \" + ($input.first().json.mensagem || \"Nova chamada\"),\n    \"resumo\": $input.first().json.mensagem || \"Nova chamada\",\n    \"status\": \"notificacao\"\n  }\n]"
          },
          "id": "function_extract",
          "name": "Extrair Dados",
          "type": "n8n-nodes-base.function",
          "typeVersion": 1,
          "position": [
            450,
            300
          ]
        },
        {
          "parameters": {
            "host": "https://l1kwgyabiotfloyvhml.supabase.co",
            "operation": "insert",
            "schema": "public",
            "table": "chamadas",
            "columns": "cliente_id,data_hora,duracao_segundos,transcricao,resumo,status",
            "options": {}
          },
          "id": "supabase_insert",
          "name": "Supabase - Registrar Notifica\u00e7\u00e3o",
          "type": "n8n-nodes-base.postgres",
          "typeVersion": 2,
          "position": [
            650,
            300
          ],
          "credentials": {
            "postgres": "supabase_secretaria"
          }
        }
      ],
      "connections": {
        "webhook_notificar": {
          "main": [
            [
              {
                "node": "function_extract",
                "branch": 0,
                "slot": 0
              }
            ]
          ]
        },
        "function_extract": {
          "main": [
            [
              {
                "node": "supabase_insert",
                "branch": 0,
                "slot": 0
              }
            ]
          ]
        }
      },
      "active": true,
      "settings": {
        "executionOrder": "v1"
      }
    }
  ]
}